# 
# GitHub Actions workflow.
#
# Automatically deploys the Node.js microservice to Kubernetes on push to the main branch.
# For real use you might want to restrict this to the "prod" branch.
#

name: Deploy microservice

on:
  # Deploys the microservice on push to the specified subdirectory in the main branch of this code repository.
  push: 
    branches:
      - main    
  # Allows deployment to be invoked manually through the GitHub Actions user interface.
  workflow_dispatch: 

jobs:
  deploy-video-streaming:
    uses: ./github/workflows/deploy-template.yaml
    with:
      NAME: video-streaming
      DIRECTORY: video-streaming    

    # steps:
    #   # Build and publish the image
    #   - uses: actions/checkout@v3
    #   - run: ./scripts/cd/image-build.sh
      
    #   - name: Publish
    #     run: ./scripts/cd/image-push.sh

    #   # Installs Kubectl and connects it to the cluster.
    #   # https://github.com/marketplace/actions/kubernetes-cli-kubectl
    #   - uses: tale/kubectl-action@v1
    #     with:
    #       base64-kube-config: ${{ secrets.KUBE_CONFIG }}
    #       kubectl-version: v1.29.4
      
    #   # Expands the configuration template and deploys the microservice.
    #   - name: Deploy
    #     run: ./scripts/cd/deploy.sh